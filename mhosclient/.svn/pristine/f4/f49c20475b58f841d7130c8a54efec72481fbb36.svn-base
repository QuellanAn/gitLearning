$(document).ready(function() {
	var paras = $("#form_query").serialize();
	initTu(paras);
	
	$("#act_query").click(function(e) {
		var paras = $("#form_query").serialize();
		initTu(paras);
		return false;
	});
	
	$('input[name=startTime]').datepicker({ dateFormat: 'yy-mm-dd' });
	$('input[name=endTime]').datepicker({ dateFormat: 'yy-mm-dd' });
	
	$('input[name=startTime]').change(function() {
		$("input[name='po.timeType']").removeAttr("checked");
	});
	
	$('input[name=endTime]').change(function() {
		$("input[name='po.timeType']").removeAttr("checked");
	});
	
	$("input[name='po.timeType']").change(function() {
		$("#startTime").val("");
		$("#endTime").val("");
	});
});

function initTu(paras){
	var myChart = echarts.init(document.getElementById('Section1'));
	myChart.showLoading({text : '正在努力请求数据,请稍等!' }); 
	var xiang=$('input:radio[name="xiangmu"]:checked').val();
	var leib=$('input:radio[name="po.analysisType"]:checked').val();
	var type=null;
	var title=null;
	if(xiang==1){
		type="{b} : {c}元\n ({d}%)";
	}else if(xiang==2){
		type="{b} : {c}笔\n({d}%)";
	}
	if(leib==1){
		title="院区占比分析图";
	}else if(leib==2){
		title="支付方式占比分析图";
	}else if(leib==3){
		title="支付场景占比分析图";
	}else if(leib==4){
		title="缴费项目占比分析图";
	}
	$.ajax({
		type : "post",
		url : "unpaid/selectStatistics_selectByTjfx",
		dataType : "json",
		data : paras,
		async : false,
		success : function(data) {
			var rows = eval(data.view);
			if(rows.length<=0){
				$("#Section1").html("当前时间暂无数据!");
				myChart.hideLoading();
				return false;
			}
			var arr = [];
			for ( var i = 0; i < rows.length; i++) {
				arr.push(rows[i].name);
			}
			option = {
		title : {
			text : title,
			x : 'center'
		},
		tooltip : {
			trigger : 'item',
			formatter : type
		},

		legend : {
			orient : 'vertical',
			left : 'left',
			data : arr
		},
		toolbox : {
			show : true,
			feature : {
				saveAsImage : {},
				restore : {}
			}
		},
		series : [ {
			name : '院区',
			type : 'pie',
			radius : '70%',
			center : [ '50%', '60%' ],
			data : rows,
			itemStyle : {
				normal : {
					label : {
						show : true,
						formatter : type
					},
					labelLine : {
						show : true
					}
				}
			}
		} ],
		color : [ '#FD7054', '#5FD1CE' ]
	};
	myChart.setOption(option);	
	myChart.hideLoading();
	},error: function() {
		alert("图表请求数据失败!");
		myChart.hideLoading();
	},
	});	
};